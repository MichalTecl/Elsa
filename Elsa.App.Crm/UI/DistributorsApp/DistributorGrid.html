<div id="digrMainCont">
    <div id="digrGridCont" data-bind="class.hidden:isDetailOpen">
        <div id="digrFilters">
            <div class="digrFiltersRow">
                <div class="digrFiltersSection" id="digrFilterText">
                    <label>Text</label>
                    <input type="text" id="digrTextFilter" event-bind="change:setFilter('text', '', this.value)" />
                </div>
            </div>

            <div class="digrFiltersRow">
                <div class="digrFiltersSection" id="digrFilterTags">
                    <div class="digrTagFilters" data-bind="itemsSource:allTags" data-key="Id">
                        <div class="lt-template digrFilterTag">
                            <input type="checkbox" event-bind="change:setFilter('tag', Id, this.checked)" />
                            <label data-bind="text:Name"></label>
                        </div>
                    </div>
                </div>
            </div>

            <div class="digrFiltersRow">
                <div class="digrFiltersSection" id="digrFilterGroups">
                    <label>Kategorie</label>
                    <select class="digrCustomerGroupFilters" data-bind="itemsSource:allCustomerGroups" data-key="Id" event-bind="change:setFilter('customerGroup', '', this.value)">
                        <option class="lt-template digrCustomerGroupFilterOption" data-bind="text:ErpGroupName; value:Id"></option>
                    </select>
                </div>

                <div class="digrFiltersSection" id="digrFilterSalesRep">
                    <label>OZ</label>
                    <select class="digrSrepSelect" data-bind="itemsSource:allSalesReps" data-key="Id" event-bind="change:setFilter('salesRep', '', this.value)">
                        <option class="lt-template digrSalesRepSelectOption" data-bind="text:PublicName;value:Id"></option>
                    </select>
                </div>

                <div class="digrFiltersSection" id="digrFilterSortOption">
                    <label>Třídění</label>
                    <select class="digrSortTypeSelect" data-bind="itemsSource:allSorters" data-key="Id" event-bind="change:setFilter('sorter', '', this.value)">
                        <option class="lt-template digrSorterTypeOption" data-bind="text:Text;value:Id"></option>
                    </select>
                </div>
            </div>

            <div class="digrFiltersRow digrExFiltersRow">
                <div class="digrExFiltersExpander">
                    <i class="fas fa-filter digrFilterButtonAddNew" data-bind="class.hidden:exFiltersExpanded" event-bind="click:VM.addFilter()"></i>
                    <i class="fas fa-filter digrFilterButtonAsIcon" data-bind="class!.hidden:exFiltersExpanded"></i>
                </div>
                <div class="digrExFiltersContainer" data-bind="class!.hidden:exFiltersExpanded" fill-by="/UI/DistributorsApp/ExFilters.html">
                </div>
            </div>

            <div class="digrFiltersRow">
                <button id="butSearch" event-bind="click:VM.search()"><i class="fas fa-search"></i></button>

                <div class="digrFiltersSection" id="digrFilterIncludeDeleted">
                    <input type="checkbox" class="digrFilterIncludeDisabledCb" event-bind="change:setFilter('direct', 'IncludeDisabled', this.checked)" />
                    <label>Zahrnout zrušené</label>
                </div>

                <div class="digrBulkTaggerIcon">
                    <i class="fas fa-rocket faButtonNew bulkTaggingOpenButton" data-bind="class.hidden:bulkTaggingOpen" event-bind="click:openBulkTagging()"></i>
                </div>

            </div>

            <div class="digrFiltersRow bulkTaggingRow" data-bind="class!.hidden:bulkTaggingOpen">
                <div class="bulkTaggingRowTop">
                    <i class="fas fa-times faButtonNew bulkTaggingCloseButton" event-bind="click:closeBulkTagging()"></i>
                </div>

                <div class="bulkTaggingSetupPanel">
                    <div class="bulkTaggingSetupText">Všem odpovídajícím kontaktům</div>
                    <div class="bulkTaggignSetupRadios">
                        <input type="radio" name="rbBulkTagging" id="rbbtgSet" checked /><label for="rbbtgSet">nastavit</label>
                        <input type="radio" name="rbBulkTagging" id="rbbtgRemove" /><label for="rbbtgSet">odebrat</label>
                    </div>
                    <div class="bulkTaggingSetupText">štítek</div>
                    <div class="bulkTaggingTagInputWrap autocomplete" id="bulkTaggingTagFinder">
                        <input type="text" id="bulkTaggingTagNameInput" />
                    </div>
                    <button class="bulkTaggingRunbutton" event-bind="click:startBulkTagging($bulkTaggingTagNameInput.value, $rbbtgSet.checked, rbbtgRemove.checked)"><i class="fas fa-play"></i></button>
                </div>

            </div>

        </div>

            <div class="grid2">
                <div id="digrGrid">
                    <div class="gridRow gridHead">
                        <div class="cell10">Jméno</div>
                        <div class="cell10">Kategorie</div>
                        <div class="cell20">Štítky</div>
                        <div class="cell5">$$$</div>
                        <div class="cell10">Trend</div>
                    </div>
                    <div class="gridBody" data-bind="itemsSource:data" data-key="Id">
                        <div class="lt-template gridRow">
                            <div class="cell10 digrDetailLinkCell">
                                <a data-bind="text:Name" class="digrLinkSameWin" event-bind="click:openDetail(Id)"></a>
                                <a class="digrOutNewWin" target="_blank" data-bind="href:detailLink"> <i class="fas fa-window-restore"></i></a>
                            </div>

                            <div class="cell10 digrGroupsCell">
                                <div data-bind="itemsSource:customerGroups" data-key="Id" class="digrCustGroupsContainer stackLeft">
                                    <div class="lt-template digrCustGroupItem" data-bind="text:ErpGroupName"></div>
                                </div>
                            </div>

                            <div class="cell20 digrTagsCell">
                                <div data-bind="itemsSource:tags" data-key="Id" class="digrCustTagsContainer stackLeft">
                                    <div class="lt-template digrCustTagItem" data-bind="text:Name;cssClass:CssClass"></div>
                                </div>
                            </div>

                            <div class="cell5 digrTotalPriceCell" data-bind="text:TotalOrdersPriceF"></div>

                            <div class="cell10 digrTrendCell">
                                <div data-bind="itemsSource:TrendModel" data-key="id" class="digrTrendView">
                                    <div data-bind="style.height:height;class.digrTrendItemEmpty:IsEmpty;title:symbol" class="lt-template digrTrendItem"></div>
                                </div>
                            </div>

                        </div>
                    </div>
                </div>
            </div>
            <div class="digrGridButtons">
                <button event-bind="click:VM.load()" data-bind="class!.hidden:canReadMore">Načíst více</button>
            </div>
        </div>
    <div id="digrDetailCont" fill-by="/UI/DistributorsApp/DistributorDetailView.html" data-bind="class!.hidden:isDetailOpen"></div>
</div>



<script>
    lt.element("digrMainCont")
        .withModel("app.Distributors.vm")
        .attach(function (digrTextFilter, bulkTaggingTagFinder) {
                        
            digrTextFilter.addEventListener('keydown', function (e) {
                if (e.key === 'Enter') {
                    this.dispatchEvent(new Event('change'));
                }
            });
                        
            digrTextFilter.addEventListener('focus', function () {
                this.select();
            });

            setTimeout(() => digrTextFilter.focus(), 10);

            this.setFilter = (type, key, value) => app.Distributors.vm.updateFilter(type, key, value);

            this.openDetail = (customerId) => {
                window.location.hash = 'customerId=' + customerId;
                return false;
            };

            this.openBulkTagging = () => {
                app.Distributors.vm.openBulkTagging();

                app.ui.autosuggest(bulkTaggingTagFinder, app.Distributors.vm.getAllTags);
            };

            this.startBulkTagging = (tagName, set, remove) => {

                if (!tagName) {
                    alert("Není vybrán štítek");
                    return;
                }

                if (set === remove) {
                    alert("Není vybrána akce (nastavit/odebrat)");
                    return;
                }

                app.Distributors.vm.startBulkTagging(tagName, set);
            }

            this.closeBulkTagging = () => app.Distributors.vm.closeBulkTagging();

        });
</script>

<link href="/UI/DistributorsApp/Css/DistributorGrid_Filters.css" rel="stylesheet" />
<link href="/UI/DistributorsApp/Css/DistributorGrid_grid.css" rel="stylesheet" />

<link href="/Style/NewGrid.css" rel="stylesheet" />