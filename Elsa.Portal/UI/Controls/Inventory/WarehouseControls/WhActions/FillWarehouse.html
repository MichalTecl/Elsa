<div id="fillWh">
    <div class="stackLeft">
        <div id="autosug" class="autocomplete" placeholder="Název materiálu">
            <input id="materialName" />
        </div>

        <input id="volume" placeholder="Množství" type="number" step="0.01" align="right"/>

        <input id="unit" placeholder="Jednotka"/>
    </div>
    
    <input id="description" placeholder="Popis" />
    
    <div class="stackRight">
        <button event-bind="click:onSaveClick"></button>
    </div>
    
    <div id="eventsHistory">
        <div id="eventTemplate">
            <div class="eventDt" data-bind="text:Dt"></div>
            <div class="eventAuthor" data-bind="text:Author"></div>
            <div class="eventContent" data-bind="text:Content"></div>
            <div class="eventNote" data-bind="text:Note"></div>
        </div>
    </div>
    
    <button id="butLoadOlder" style="display:none" event-bind="click:onLoadOlderClick">Starší</button>
</div>

<script>
    lt.element("fillWh").withModel("app.warehouseActions.vm").attach(function(materialName, volume, unit, description, autosug, eventsHistory, eventTemplate, butLoadOlder) {
        
        app.ui.autosuggest(autosug, app.warehouseActions.vm.searchMaterialNames);

        var resetForm = function() {
            materialName.value = '';
            volume.value = '';
            unit.value = '';
            description.value = '';

            setTimeout(function () {
                materialName.focus();
            }, 0);
        };

        resetForm();

        this.onSaveClick = function() {
            app.warehouseActions.vm.saveWarehouseFillAction(materialName.value,
                volume.value,
                unit.value,
                description.value,
                resetForm);
        };

        this.bind(function(materialStockEvents) {
            lt.generate(eventsHistory, eventTemplate, materialStockEvents, function (e) { return e.Id; });

            if (materialStockEvents && materialStockEvents.length > 0) {
                butLoadOlder.style.display = 'block';
            }
        });

        this.onLoadOlderClick = function() {
            app.warehouseActions.vm.loadMaterialStockEvents();
        };
    });
</script>