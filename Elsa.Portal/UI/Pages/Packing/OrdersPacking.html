<!DOCTYPE html>
<html>
<head>
    <title>ELSA</title>
    <meta charset="utf-8" />
    <script src="/Bundles/Bundle.ashx?bundle=Lanta"></script>
    <script src="/Script/Apps/User/UserVM.js"></script>
    <link href="/Style/Appearance.css" rel="stylesheet" />
    <link href="/Style/Layout.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.3.1/css/all.css" integrity="sha384-mzrmE5qonljUremFsqc01SB46JvROS7bZs3IO2EmfFsd15uHvIt+Y8vEf7N7fWAU" crossorigin="anonymous">
</head>
<body>
    <div class="panel w4" style="height:100%">
        <div class="panelContent" id="packingUi" >
            <div class="panelHead" style="margin: 0; margin-bottom: 10px;">
                <div class="panelTitle">Balení objednávek</div>
            </div> 
            <div id="packingUiMainCont">
                <div id="orderSearchPanel">
                    <div id="tbSearchContainer">
                        <input id="tbSearch" event-bind="keydown:onSearchKeyDown(event, this.value)"/>
                    </div>
                </div>
                <div id="orderViewPanel">
                    <div id="orderOverviewPanel" class="stackLeft">
                        <i class="far fa-caret-square-left faButton" event-bind="click:onPackingCancel"></i>

                        <i id="lblOrderNumber" data-bind="text:currentOrder.OrderNumber"></i>
                        <a id="lblCustomerName" data-bind="text:currentOrder.CustomerName; title:currentOrder.CustomerEmail"></a>
                        <i id="lblPrice" data-bind="text:currentOrder.Price"></i>

                        <i id="lblSourceErp" data-bind="text:currentOrder.ErpName"></i>
                    </div>
                    <div id="orderNotesPanel">
                        <div id="customerNotePanel" data-bind="class!.hidden:currentOrder.hasCustomerNote">
                            <div id="customerNoteTitle">Vzkaz od zákazníka</div>
                            <p id="customerNoteBody" data-bind="text:currentOrder.CustomerNote"></p>
                        </div>
                        <div id="internalNotePanel" data-bind="class!.hidden:currentOrder.hasInternalNote">
                            <div id="internalNoteTitle">Interní poznámka</div>
                            <p id="internalNoteBody" data-bind="text:currentOrder.InternalNote"></p>
                        </div>
                    </div>
                    <div id="orderItemsContainer">

                    </div>
                    <div id="packingControlPanel">
                        <button id="butPackOrder">Zabaleno</button>
                    </div>
                </div>
            </div>

        </div>
    </div>
    
    <script>

    lt.element("packingUi")
        .withModel("app.ordersPacking.vm")
        .attach(function (orderSearchPanel, orderViewPanel, tbSearch, orderOverviewPanel, lblCustomerName) {

            var self = this;

            var focusSearch = function() {
                setTimeout(function() {
                    tbSearch.focus();

                    try {
                        tbSearch.select();
                    }catch (e){}

                    try {
                        tbSearch.setSelectionRange(0, tbSearch.value.length);
                    }catch(e){}

                }, 10);



            };

            this.bind(function(currentOrder) {
                if (currentOrder === null || currentOrder === undefined) {
                    orderSearchPanel.style.display = 'block';
                    orderViewPanel.style.display = 'none';
                    focusSearch();
                } else {
                    orderSearchPanel.style.display = 'none';
                    orderViewPanel.style.display = 'flex';
                    //lt.setViewModel(orderOverviewPanel, currentOrder);
                    lblCustomerName.setAttribute("href", "mailto:" + currentOrder.CustomerEmail);
                }
                }).currentOrderCanBeNull();

            this.onSearchKeyDown = function(event, value) {

                if (event.key !== "Enter") {
                    return;
                }
            
                app.ordersPacking.vm.searchOrder(value);
            };

            this.onPackingCancel = function() {
                app.ordersPacking.vm.cancelCurrentOrder();
                
            };

            document.onkeydown = function (evt) {
                evt = evt || window.event;
                var isEscape = false;
                if ("key" in evt) {
                    isEscape = (evt.key === "Escape" || evt.key === "Esc");
                } else {
                    isEscape = (evt.keyCode === 27);
                }
                if (isEscape) {
                    self.onPackingCancel();
                }
            };

        });
            
    </script>
    
<script src="/Script/Apps/Packing/OrdersPacking.VM.js"></script>
<link href="PackingUI.css" rel="stylesheet" />
    

</body>
</html>
